<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../layui/css/layui.css">
    <script src="../layui/layui.all.js"></script>
    <script src="../layui/echarts.min.js"></script>
    <script src="../layui/axios.min.js"></script>
</head>

<body style="">
<fieldset class="layui-elem-field layui-field-title">
    <legend>各科成绩图表</legend>
</fieldset>
<div id="line" style="height:500px; width: 95%;"></div>

<br>
<fieldset class="layui-elem-field layui-field-title">
    <legend>成绩表</legend>
</fieldset>
<table class="layui-hide" id="score_table" , lay-filter="scores"></table>

<script type="text/html" id="barDemo">
    <!-- <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a> -->
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

</body>

<script type='text/javascript'>
    //折线图
    optionLine = {
        title: {
            text: ''
        },
        toolbox: {
            show: true,
            feature: {

                magicType: {type: ['line', 'bar']},
                markPoint: {},
                restore: {},
            }
        },
        legend: {
            data: ['语文', '数学'],
            align: 'left',
            top: '4'
        },
        xAxis: {
            type: 'category',
            data: ['周一', '周二', '周三', '周四', '周五', '周六', '周日']
        },
        yAxis: {
            name: '分数(100)',
            type: 'value',
        },
        series: [{
            name: '语文',
            data: [22, 25, 35, 28, 20, 45, 52],
            type: 'line'
        }, {
            name: '数学',
            data: [12, 21, 29, 35, 24, 56, 48],
            type: 'line'
        }],
        tooltip: {
            trigger: 'axis'
        },
        grid: {
            show: false,
            borderColor: '#ebebeb',
            x: 33,
            x2: 0,
            y: 40,
            y2: 0,
            height: 400
        },
    };
    var domLine = document.getElementById("line");
    var chartLine = echarts.init(domLine, 'theme-ax');
    chartLine.setOption(optionLine, true);


    layui.use('table', function () {
        var table = layui.table;
        var $ = layui.$;
        table.render({
            elem: '#score_table'
            , url: "http://localhost:8080/score/findScoreAll"
            // , where: { "type": "语文" }
            , request: {
                pageName: 'pageNum' //页码的参数名称，默认：page
                , limitName: 'pageSize' //每页数据量的参数名，默认：limit
            }
            , parseData: function (res) { //res 即为原始返回的数据
                return {
                    "code": res.status, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": 2, //解析数据长度
                    "data": res.body.scorns //解析数据列表
                };
            }
            , cols: [[
                {field: 'id', width: 100, title: 'ID'}
                , {field: 'subject', title: '学科', sort: true}
                , {field: 'score', title: '成绩', sort: true}
                , {field: 'type', title: '分类', sort: true}
                , {field: 'tDate', minWidth: 300, title: '考试时间', sort: true}
                , {fixed: 'right', width: 178, align: 'center', toolbar: '#barDemo'}
            ]]
            // , data: [{ id: "A", subject: "1", score: "1", type: "1", time: new Date().toLocaleDateString() }
            //     , { id: "B", subject: "1", score: "2", type: "1", time: new Date().toLocaleDateString() }
            //     , { id: "1", subject: "1", score: "2", type: "1", time: new Date().toLocaleDateString() }
            //     , { id: "1", subject: "1", score: "1", type: "1", time: new Date().toLocaleDateString() }]
            , done: function (res, curr, count) {
                //如果是异步请求数据方式，res即为你接口返回的信息。
                //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
                console.log(res);
            }
        });
        //监听工具条
        table.on('tool(scores)', function (obj) {
            var data = obj.data;
            if (obj.event === 'del') {
                layer.confirm('真的删除id=' + data.id + '的成绩么', function (index) {
                    delete_request(data.id);
                    obj.del();
                    layer.close(index);
                });
            } else if (obj.event === 'edit') {
                layer.alert('编辑行：<br>' + JSON.stringify(data))
            }
        });

        function delete_request(id) {
            axios({
                method: 'delete',
                url: '/score/deleteScore',
                data: {
                    id: id,
                }
            }).then(function (response) {
                layer.msg("删除成功");
            }).catch(function (error) {
                layer.alert("删除失败\n" + error);
            })
        };
    });

</script>


</html>